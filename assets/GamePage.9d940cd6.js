import{Q as H}from"./QBtn.393f7f03.js";import{_ as F,y,z as x,C as p,ad as U,D as G,ab as X,ae as I,I as D,F as N,af as q,r as c,o as K,w as L,j as w,V as Z,ac as ee,G as te,H as ae,ag as se,ah as le}from"./index.0e4d0be3.js";const re={},oe={class:"game-tile"},ue={class:"game-tile__text"};function ne(h,f){return y(),x("div",oe,[p("div",ue,[U(h.$slots,"default",{},void 0,!0)])])}var ie=F(re,[["render",ne],["__scopeId","data-v-6f6eb2bd"]]);const ve=G({__name:"GameProgress",props:{type:{default:"success"},progress:{},index:{}},setup(h){return(f,d)=>(y(),x("div",{class:X(["progress",`num-${f.index}`]),style:I(`--width: ${22.02*f.progress}vw`)},[p("div",{class:X(["progress__bar",`${f.type}`])},null,2)],6))}});var P=F(ve,[["__scopeId","data-v-a2d99bea"]]);const ce={class:"task__translate"},fe=G({__name:"GameTask",props:{letter:{}},setup(h){const f={\u58EB:"sh\xEC \u0432\u043E\u0438\u043D",\u95E8:"m\xE9n \u0434\u0432\u0435\u0440\u044C",\u4EBA:"r\xE9n \u0447\u0435\u043B\u043E\u0432\u0435\u043A",\u5973:"n\u01DA \u0436\u0435\u043D\u0449\u0438\u043D\u0430",\u5B50:"z\u01D0 \u0440\u0435\u0431\u0451\u043D\u043E\u043A"};return(d,b)=>(y(),x(N,null,[p("div",{class:"task__letter",style:I(`color: ${d.letter.color}`)},D(d.letter.letter),5),p("div",ce,D(f[d.letter.letter]),1)],64))}});const de={class:"game-area__tiles"},ye=G({__name:"GameArea",setup(h){const f=q(),d=["#8EFF00","#741926","#00FFBB","#ED1313","#FCCE00"],b=["\u58EB","\u95E8","\u4EBA","\u5973","\u5B50"],n=c([]),m=a=>{for(let l=a.length-1;l>0;l--){let e=Math.floor(Math.random()*(l+1));[a[l],a[e]]=[a[e],a[l]]}};m(d);const g=b.map((a,l)=>({letter:a,color:d[l]})),T=JSON.parse(JSON.stringify(g));m(T),console.log(T[0].letter);const k=c(0),A=()=>{const a=[];for(let e=0;e<36;e++)m(g),a.push({x:Math.floor(e%6),y:Math.floor(e/6),diffY:0,...g[0]});if(C(a).length||!B(a))return A();a.forEach(e=>({...e,preRemoved:!1})),n.value=a},$=c(null),u=c(null),v=c(null),i=c(null),Y=c(""),R=c(""),V=(a,l)=>{_.value||(a.touches?$.value={x:a.touches[0].clientX,y:a.touches[0].clientY}:$.value={x:a.x,y:a.y},i.value=a.target,u.value=l,Y.value=i.value.style.left,R.value=i.value.style.top)},W=a=>{if(_.value)return;let l={};a.touches?l={x:a.touches[0].clientX,y:a.touches[0].clientY}:l={x:a.x,y:a.y};const e={x:l.x-$.value.x,y:l.y-$.value.y};if(Math.abs(e.x)>Math.abs(e.y)){const t=e.x*100/window.innerWidth;Math.abs(t)<10.8&&(i.value.style.left=`calc(${Y.value} + ${e.x*100/window.innerWidth}vw)`),i.value.style.top=R.value}else{const t=e.y*100/window.innerWidth;Math.abs(t)<10.8&&(i.value.style.top=`calc(${R.value} + ${e.y*100/window.innerWidth}vw)`),i.value.style.left=Y.value}i.value.style.zIndex=1,i.value.style.transition="none"},j=()=>{if(!i.value||!u.value||_.value)return;i.value.style.transition="",i.value.style.zIndex=0;const a=parseFloat(i.value.style.left.split("(")[1]),l=parseFloat(i.value.style.top.split("(")[1]);let e=[];isNaN(a)||(a-parseFloat(Y.value)>0?e=n.value.filter(s=>s.x===u.value.x+1&&s.y===u.value.y):e=n.value.filter(s=>s.x===u.value.x-1&&s.y===u.value.y)),isNaN(l)||(l-parseFloat(R.value)>0?e=n.value.filter(s=>s.x===u.value.x&&s.y===u.value.y+1):e=n.value.filter(s=>s.x===u.value.x&&s.y===u.value.y-1));const t=e.find(s=>!s.isRemoved),r={x:u.value.x,y:u.value.y};t?(v.value=t,u.value.y=v.value.y,u.value.x=v.value.x,v.value.x=r.x,v.value.y=r.y):(i.value.style.left=`${u.value.x*10.83+u.value.x*1.44}vw`,i.value.style.top=`${u.value.y*10.83+u.value.y*1.44}vw`),J()};K(()=>{document.addEventListener("touchend",j),A()});const _=c(!1),J=()=>{_.value=!0;const a=C(n.value,!0);setTimeout(()=>{if(!a.length&&u.value&&v.value){const l={x:u.value.x,y:u.value.y};u.value.y=v.value.y,u.value.x=v.value.x,v.value.x=l.x,v.value.y=l.y,_.value=!1,u.value=null,v.value=null;return}if(!a.length&&!B(n.value)){z();return}_.value=!1,u.value=null,v.value=null,Q(a)},300)},C=(a,l=!1)=>{const e=[];for(let t=0;t<6;t++)e.push(a.filter(r=>r.y===t&&!r.isRemoved)),e.push(a.filter(r=>r.x===t&&!r.isRemoved));return e.forEach(t=>{let r=[];t.sort(function(s,o){return s.x>o.x&&s.y===o.y||s.y>o.y&&s.x===o.x?1:s.x<o.x&&s.y===o.y||s.y<o.y&&s.x===o.x?-1:0}),t.forEach(s=>{if(!r.length){r.push(s);return}const o=r[r.length-1];s.letter===o.letter&&(s.x-o.x===1||s.y-o.y===1)?r.push(s):r=[s],r.length>2&&(r.find(S=>S.letter===T[E.value].letter)&&l&&k.value++,r.forEach(S=>{S.preRemoved=!0}))})}),a.filter(t=>t.preRemoved)},E=c(0);L(k,a=>{a>=3&&setTimeout(()=>{k.value=0,E.value++},500)}),L(E,a=>{a>=T.length-1&&setTimeout(()=>{f.push({path:"/"})},500)});const Q=a=>{a.forEach(l=>{m(g);const e=O(l.x,-1),t={x:l.x,y:e,diffY:Math.abs(e)-1,...g[0]};n.value.push(t);const r=n.value.filter(s=>s.y<l.y&&s.x===l.x&&!s.isRemoved&&!s.preRemoved);r.length&&r.forEach(s=>{s.diffY+=1}),l.preRemoved=!1,l.isRemoved=!0}),setTimeout(()=>{const l=n.value.filter(e=>e.diffY);l.length&&(l.forEach(e=>{e.y=e.y+e.diffY,e.diffY=0}),J())},100)},O=(a,l)=>n.value.find(t=>t.x===a&&t.y===l)?O(a,l-1):l,z=()=>{let a=JSON.parse(JSON.stringify(n.value.filter(t=>!t.isRemoved))),l=JSON.parse(JSON.stringify(n.value.filter(t=>!t.isRemoved)));m(a);for(let t=0;t<36;t++){const r=a[t];r.oldX=r.x,r.oldY=r.y,r.x=Math.floor(t%6),r.y=Math.floor(t/6)}if(l=l.map(t=>{const r=a.find(s=>s.oldX===t.x&&s.oldY===t.y);return{...t,x:r.x,y:r.y}}),C(l).length||!B(a))return z();n.value=n.value.map(t=>{const r=a.find(s=>s.oldX===t.x&&s.oldY===t.y);return{...t,x:r.x,y:r.y}})},B=a=>{const l=JSON.parse(JSON.stringify(a.filter(e=>!e.isRemoved)));for(let e=0;e<36;e++){const t=l[e];t.initX=t.x,t.initY=t.y;for(let r=0;r<4;r++){let s={x:0,y:0};switch(r){case 0:s.x=1,s.y=0;break;case 1:s.x=-1,s.y=0;break;case 2:s.x=0,s.y=1;break;case 3:s.x=0,s.y=-1;break}const o=l.find(M=>M.x===t.x+s.x&&M.y===t.y+s.y);if(o){if(o.initX=o.x,o.initY=o.y,o.x=t.initX,o.y=t.initY,t.x=o.initX,t.y=o.initY,C(l).length)return e=36,r=4,t;if(t.x=t.initX,t.y=t.initY,o.x=o.initX,o.y=o.initY,e===35)return null}}}};return(a,l)=>(y(),x(N,null,[w(fe,{letter:Z(T)[E.value]},null,8,["letter"]),w(P,{progress:100/3*k.value*.01,index:"1"},null,8,["progress"]),p("div",{class:X(["game-area",{animating:_.value}])},[p("div",de,[(y(!0),x(N,null,ee(n.value,(e,t)=>(y(),x(N,{key:t+e.letter},[e.isRemoved?le("",!0):(y(),te(ie,{key:0,style:I({left:`${e.x*10.83+e.x*1.44}vw`,top:`${e.y*10.83+e.y*1.44}vw`,color:e.color}),onTouchstart:r=>V(r,e),onTouchmove:W,"data-letter":e.letter,"data-x":e.x,"data-y":e.y},{default:ae(()=>[se(D(e.letter),1)]),_:2},1032,["style","onTouchstart","data-letter","data-x","data-y"]))],64))),128))])],2),w(P,{progress:100/5*E.value*.01,index:"2",type:"error"},null,8,["progress"])],64))}});var _e=F(ye,[["__scopeId","data-v-5b0fcfe4"]]);const xe={class:"game"},pe=G({__name:"GamePage",setup(h){return(f,d)=>(y(),x("div",xe,[w(H,{class:"game__back",to:"/",flat:""}),w(_e)]))}});var ge=F(pe,[["__scopeId","data-v-eaf49ec8"]]);export{ge as default};
