import{Q as U}from"./QBtn.c2a9c63f.js";import{_ as G,y,z as x,C as p,ad as q,D as B,ab as I,ae as D,I as X,F,af as K,r as c,o as Z,w as L,j as k,V as ee,ac as te,G as se,H as ae,ag as le,ah as re}from"./index.a29f8f44.js";const oe={},ue={class:"game-tile"},ne={class:"game-tile__text"};function ie(h,f){return y(),x("div",ue,[p("div",ne,[q(h.$slots,"default",{},void 0,!0)])])}var ve=G(oe,[["render",ie],["__scopeId","data-v-6f6eb2bd"]]);const ce=B({__name:"GameProgress",props:{type:{default:"success"},progress:{},index:{}},setup(h){return(f,d)=>(y(),x("div",{class:I(["progress",`num-${f.index}`]),style:D(`--width: ${22.02*f.progress}vw`)},[p("div",{class:I(["progress__bar",`${f.type}`])},null,2)],6))}});var P=G(ce,[["__scopeId","data-v-a2d99bea"]]);const fe={class:"task__translate"},de=B({__name:"GameTask",props:{letter:{}},setup(h){const f={\u58EB:"sh\xEC \u0432\u043E\u0438\u043D",\u95E8:"m\xE9n \u0434\u0432\u0435\u0440\u044C",\u4EBA:"r\xE9n \u0447\u0435\u043B\u043E\u0432\u0435\u043A",\u5973:"n\u01DA \u0436\u0435\u043D\u0449\u0438\u043D\u0430",\u5B50:"z\u01D0 \u0440\u0435\u0431\u0451\u043D\u043E\u043A"};return(d,b)=>(y(),x(F,null,[p("div",{class:"task__letter",style:D(`color: ${d.letter.color}`)},X(d.letter.letter),5),p("div",fe,X(f[d.letter.letter]),1)],64))}});const ye={class:"game-area__tiles"},_e=B({__name:"GameArea",setup(h){const f=K(),d=["#8EFF00","#741926","#00FFBB","#ED1313","#FCCE00"],b=["\u58EB","\u95E8","\u4EBA","\u5973","\u5B50"],n=c([]),m=s=>{for(let l=s.length-1;l>0;l--){let e=Math.floor(Math.random()*(l+1));[s[l],s[e]]=[s[e],s[l]]}};m(d);const g=b.map((s,l)=>({letter:s,color:d[l]})),T=JSON.parse(JSON.stringify(g));m(T),console.log(T[0].letter);const R=c(0),A=()=>{const s=[];for(let e=0;e<36;e++)m(g),s.push({x:Math.floor(e%6),y:Math.floor(e/6),diffY:0,...g[0]});if(N(s).length||!S(s))return A();s.forEach(e=>({...e,preRemoved:!1})),n.value=s},Y=c(null),u=c(null),v=c(null),i=c(null),C=c(""),M=c(""),V=(s,l)=>{_.value||(s.touches?Y.value={x:s.touches[0].clientX,y:s.touches[0].clientY}:Y.value={x:s.x,y:s.y},i.value=s.target,u.value=l,C.value=i.value.style.left,M.value=i.value.style.top)},W=s=>{if(_.value)return;let l={};s.touches?l={x:s.touches[0].clientX,y:s.touches[0].clientY}:l={x:s.x,y:s.y};const e={x:l.x-Y.value.x,y:l.y-Y.value.y};if(Math.abs(e.x)>Math.abs(e.y)){const t=e.x*100/window.innerWidth;Math.abs(t)<10.8&&(i.value.style.left=`calc(${C.value} + ${e.x*100/window.innerWidth}vw)`),i.value.style.top=M.value}else{const t=e.y*100/window.innerWidth;Math.abs(t)<10.8&&(i.value.style.top=`calc(${M.value} + ${e.y*100/window.innerWidth}vw)`),i.value.style.left=C.value}i.value.style.zIndex=1,i.value.style.transition="none"},j=()=>{if(!i.value||!u.value||_.value)return;i.value.style.transition="",i.value.style.zIndex=0;const s=parseFloat(i.value.style.left.split("(")[1]),l=parseFloat(i.value.style.top.split("(")[1]);let e=[];isNaN(s)||(s-parseFloat(C.value)>0?e=n.value.filter(a=>a.x===u.value.x+1&&a.y===u.value.y):e=n.value.filter(a=>a.x===u.value.x-1&&a.y===u.value.y)),isNaN(l)||(l-parseFloat(M.value)>0?e=n.value.filter(a=>a.x===u.value.x&&a.y===u.value.y+1):e=n.value.filter(a=>a.x===u.value.x&&a.y===u.value.y-1));const t=e.find(a=>!a.isRemoved),r={x:u.value.x,y:u.value.y};t?(v.value=t,u.value.y=v.value.y,u.value.x=v.value.x,v.value.x=r.x,v.value.y=r.y):(i.value.style.left=`${u.value.x*10.83+u.value.x*1.44}vw`,i.value.style.top=`${u.value.y*10.83+u.value.y*1.44}vw`),J()};Z(()=>{document.addEventListener("touchend",j),A()});const _=c(!1),J=()=>{_.value=!0;const s=N(n.value,!0);setTimeout(()=>{if(!s.length&&u.value&&v.value){const l={x:u.value.x,y:u.value.y};u.value.y=v.value.y,u.value.x=v.value.x,v.value.x=l.x,v.value.y=l.y,_.value=!1,u.value=null,v.value=null;return}if(!s.length&&!S(n.value)){z();return}_.value=!1,u.value=null,v.value=null,Q(s)},300)},N=(s,l=!1)=>{const e=[];for(let t=0;t<6;t++)e.push(s.filter(r=>r.y===t&&!r.isRemoved)),e.push(s.filter(r=>r.x===t&&!r.isRemoved));return e.forEach(t=>{let r=[];t.sort(function(a,o){return a.x>o.x&&a.y===o.y||a.y>o.y&&a.x===o.x?1:a.x<o.x&&a.y===o.y||a.y<o.y&&a.x===o.x?-1:0}),t.forEach(a=>{if(!r.length){r.push(a);return}const o=r[r.length-1];if(a.letter===o.letter&&(a.x-o.x===1||a.y-o.y===1)?r.push(a):r=[a],r.length>2){const w=r.find($=>$.letter===T[E.value].letter),H=r.find($=>$.preRemoved);w&&l&&!H&&R.value++,r.forEach($=>{$.preRemoved=!0})}})}),s.filter(t=>t.preRemoved)},E=c(0);L(R,s=>{s>=3&&setTimeout(()=>{R.value=0,E.value++},500)}),L(E,s=>{s>T.length-1&&f.push({path:"/"})});const Q=s=>{s.forEach(l=>{m(g);const e=O(l.x,-1),t={x:l.x,y:e,diffY:Math.abs(e)-1,...g[0]};n.value.push(t);const r=n.value.filter(a=>a.y<l.y&&a.x===l.x&&!a.isRemoved&&!a.preRemoved);r.length&&r.forEach(a=>{a.diffY+=1}),l.preRemoved=!1,l.isRemoved=!0}),setTimeout(()=>{const l=n.value.filter(e=>e.diffY);l.length&&(l.forEach(e=>{e.y=e.y+e.diffY,e.diffY=0}),J())},100)},O=(s,l)=>n.value.find(t=>t.x===s&&t.y===l)?O(s,l-1):l,z=()=>{let s=JSON.parse(JSON.stringify(n.value.filter(t=>!t.isRemoved))),l=JSON.parse(JSON.stringify(n.value.filter(t=>!t.isRemoved)));m(s);for(let t=0;t<36;t++){const r=s[t];r.oldX=r.x,r.oldY=r.y,r.x=Math.floor(t%6),r.y=Math.floor(t/6)}if(l=l.map(t=>{const r=s.find(a=>a.oldX===t.x&&a.oldY===t.y);return{...t,x:r.x,y:r.y}}),N(l).length||!S(s))return z();n.value=n.value.map(t=>{const r=s.find(a=>a.oldX===t.x&&a.oldY===t.y);return{...t,x:r.x,y:r.y}})},S=s=>{const l=JSON.parse(JSON.stringify(s.filter(e=>!e.isRemoved)));for(let e=0;e<36;e++){const t=l[e];t.initX=t.x,t.initY=t.y;for(let r=0;r<4;r++){let a={x:0,y:0};switch(r){case 0:a.x=1,a.y=0;break;case 1:a.x=-1,a.y=0;break;case 2:a.x=0,a.y=1;break;case 3:a.x=0,a.y=-1;break}const o=l.find(w=>w.x===t.x+a.x&&w.y===t.y+a.y);if(o){if(o.initX=o.x,o.initY=o.y,o.x=t.initX,o.y=t.initY,t.x=o.initX,t.y=o.initY,N(l).length)return e=36,r=4,t;if(t.x=t.initX,t.y=t.initY,o.x=o.initX,o.y=o.initY,e===35)return null}}}};return(s,l)=>(y(),x(F,null,[k(de,{letter:ee(T)[E.value]},null,8,["letter"]),k(P,{progress:100/3*R.value*.01,index:"1",type:"error"},null,8,["progress"]),p("div",{class:I(["game-area",{animating:_.value}])},[p("div",ye,[(y(!0),x(F,null,te(n.value,(e,t)=>(y(),x(F,{key:t+e.letter},[e.isRemoved?re("",!0):(y(),se(ve,{key:0,style:D({left:`${e.x*10.83+e.x*1.44}vw`,top:`${e.y*10.83+e.y*1.44}vw`,color:e.color}),onTouchstart:r=>V(r,e),onTouchmove:W,"data-letter":e.letter,"data-x":e.x,"data-y":e.y},{default:ae(()=>[le(X(e.letter),1)]),_:2},1032,["style","onTouchstart","data-letter","data-x","data-y"]))],64))),128))])],2),k(P,{progress:100/5*(E.value+1)*.01,index:"2",type:"error"},null,8,["progress"])],64))}});var xe=G(_e,[["__scopeId","data-v-65e98607"]]);const pe={class:"game"},he=B({__name:"GamePage",setup(h){return(f,d)=>(y(),x("div",pe,[k(U,{class:"game__back",to:"/",flat:""}),k(xe)]))}});var Te=G(he,[["__scopeId","data-v-eaf49ec8"]]);export{Te as default};
